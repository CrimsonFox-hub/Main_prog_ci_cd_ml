–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Yandex Cloud
1.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ YC CLI
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
source ~/.bashrc

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
yc init

# –°–æ–∑–¥–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–µ—Å–ª–∏ –Ω–µ—Ç)
yc billing account create --name mlops-billing

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—ã
yc compute cloud get-quotas
yc managed-kubernetes get-quotas
1.2 –°–æ–∑–¥–∞–Ω–∏–µ –æ–±–ª–∞–∫–∞ –∏ –∫–∞—Ç–∞–ª–æ–≥–∞
bash
# –°–æ–∑–¥–∞–π—Ç–µ –æ–±–ª–∞–∫–æ (–µ—Å–ª–∏ –Ω–µ—Ç)
yc resource-manager cloud create --name mlops-cloud

# –°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥
yc resource-manager folder create --name mlops-folder --cloud-name mlops-cloud

# –ü–æ–ª—É—á–∏—Ç–µ ID
YC_CLOUD_ID=$(yc resource-manager cloud get --name mlops-cloud --format json | jq -r .id)
YC_FOLDER_ID=$(yc resource-manager folder get --name mlops-folder --format json | jq -r .id)

echo "Cloud ID: $YC_CLOUD_ID"
echo "Folder ID: $YC_FOLDER_ID"

1.3 –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
bash
# –î–ª—è Terraform
yc iam service-account create --name terraform-sa
yc resource-manager folder add-access-binding $YC_FOLDER_ID \
  --role editor \
  --subject serviceAccount:$(yc iam service-account get --name terraform-sa --format json | jq -r .id)

# –î–ª—è Kubernetes
yc iam service-account create --name k8s-sa
yc resource-manager folder add-access-binding $YC_FOLDER_ID \
  --role editor \
  --subject serviceAccount:$(yc iam service-account get --name k8s-sa --format json | jq -r .id)

# –î–ª—è Container Registry
yc iam service-account create --name registry-sa
yc resource-manager folder add-access-binding $YC_FOLDER_ID \
  --role container-registry.images.pusher \
  --subject serviceAccount:$(yc iam service-account get --name registry-sa --format json | jq -r .id)

  1.4 –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞
bash
# –°–æ–∑–¥–∞–π—Ç–µ –∫–ª—é—á–∏ –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
yc iam key create \
  --service-account-name terraform-sa \
  --output terraform-key.json

yc iam key create \
  --service-account-name registry-sa \
  --output registry-key.json

# –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –¥–ª—è S3
yc iam access-key create \
  --service-account-name terraform-sa \
  --description "For S3 access" \
  --format json > s3-keys.json

  –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD —Å–µ–∫—Ä–µ—Ç–æ–≤
5.1 –ü–æ–ª—É—á–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏:
bash
# 1. –¢–æ–∫–µ–Ω –¥–ª—è YC
YC_TOKEN=$(yc iam create-token)

# 2. ID –æ–±–ª–∞–∫–∞ –∏ –∫–∞—Ç–∞–ª–æ–≥–∞
YC_CLOUD_ID=$(yc config get cloud-id)
YC_FOLDER_ID=$(yc config get folder-id)

# 3. ID —Ä–µ–≥–∏—Å—Ç—Ä–∞
YC_REGISTRY_ID=$(yc container registry get --name mlops-registry --format json | jq -r .id)

# 4. –ö–ª—é—á–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–ª—è S3
YC_ACCESS_KEY=$(jq -r .access_key.key_id s3-keys.json)
YC_SECRET_KEY=$(jq -r .secret s3-keys.json)

# 5. Kubeconfig
yc managed-kubernetes cluster get-credentials mlops-cluster-staging --external
cat ~/.kube/config | base64

# 6. –ü–∞—Ä–æ–ª—å –ë–î
DB_PASSWORD=$(terraform output -raw database_password)
5.2 –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:
text
GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret

–î–æ–±–∞–≤—å—Ç–µ:
- YC_TOKEN
- YC_CLOUD_ID
- YC_FOLDER_ID
- YC_REGISTRY_ID
- YC_SA_KEY (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ terraform-key.json)
- YC_ACCESS_KEY
- YC_SECRET_KEY
- KUBECONFIG_STAGING (base64 kubeconfig)
- DATABASE_URL
- SLACK_WEBHOOK_URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
üöÄ –®–∞–≥ 6: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
6.1 –ó–∞–ø—É—Å–∫ Terraform:
bash
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
cd infrastructure/environments/staging
cp terraform.tfvars.example terraform.tfvars
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ terraform.tfvars —Å –≤–∞—à–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

terraform init

# 2. –ü–ª–∞–Ω
terraform plan

# 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
terraform apply -auto-approve

# 4. –ü–æ–ª—É—á–∏—Ç–µ outputs
terraform output -json
6.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ kubectl:
bash
# –ü–æ–ª—É—á–∏—Ç–µ kubeconfig
yc managed-kubernetes cluster get-credentials \
  $(terraform output -raw cluster_id) \
  --external

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
kubectl cluster-info
kubectl get nodes
6.3 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx-ingress:
bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ingress-nginx
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.1/deploy/static/provider/cloud/deploy.yaml

# –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–ø—É—Å–∫–∞
kubectl wait --namespace ingress-nginx \
  --for=condition=ready pod \
  --selector=app.kubernetes.io/component=controller \
  --timeout=120s
6.4 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cert-manager:
bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ cert-manager
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.12.0/cert-manager.yaml

# –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–ø—É—Å–∫–∞
kubectl wait --namespace cert-manager \
  --for=condition=ready pod \
  --selector=app.kubernetes.io/instance=cert-manager \
  --timeout=120s
6.5 –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
bash
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –±–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
kubectl apply -f kubernetes/base/

# 2. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
kubectl create secret generic db-credentials \
  --namespace ml-production \
  --from-literal=url="postgresql://mlops_user:${DB_PASSWORD}@${DB_HOST}:6432/credit_scoring" \
  --dry-run=client -o yaml | kubectl apply -f -

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
kubectl apply -f kubernetes/credit-scoring-api/

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
kubectl get all -n ml-production
kubectl get ingress -n ml-production
üìä –®–∞–≥ 7: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
7.1 –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ kube-prometheus-stack
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

helm install prometheus prometheus-community/kube-prometheus-stack \
  --namespace monitoring \
  --create-namespace \
  --values kubernetes/monitoring-stack/values.yaml

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Loki
helm repo add grafana https://grafana.github.io/helm-charts
helm install loki grafana/loki-stack \
  --namespace logging \
  --create-namespace \
  --set grafana.enabled=false
7.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana:
bash
# –ü–æ–ª—É—á–∏—Ç–µ –ø–∞—Ä–æ–ª—å admin
kubectl get secret --namespace monitoring prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 --decode

# –ü—Ä–æ–±—Ä–æ—Å—å—Ç–µ –ø–æ—Ä—Ç
kubectl port-forward --namespace monitoring svc/prometheus-grafana 3000:80

# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã –∏–∑ kubernetes/monitoring-stack/grafana/
üîß –®–∞–≥ 8: –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
kubectl logs -l app=credit-scoring-api -n ml-production --tail=50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
kubectl get events -n ml-production --sort-by='.lastTimestamp'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
kubectl top pods -n ml-production
kubectl top nodes

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å
kubectl run -i --tty --rm debug --image=nicolaka/netshoot --restart=Never -- sh

# –ü–æ–ª—É—á–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π IP
kubectl get ingress -n ml-production -o jsonpath='{.items[0].status.loadBalancer.ingress[0].ip}'
–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
bash
# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å deployment
kubectl scale deployment/credit-scoring-api --replicas=5 -n ml-production

# –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑
kubectl set image deployment/credit-scoring-api \
  api=cr.yandexcloud.net/${YC_REGISTRY_ID}/credit-scoring-api:latest \
  -n ml-production

# –û—Ç–∫–∞—Ç–∏—Ç—å
kubectl rollout undo deployment/credit-scoring-api -n ml-production