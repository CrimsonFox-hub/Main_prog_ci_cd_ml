# … предыдущие этапы (тесты, линтинг)
build-and-push-docker:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Build Docker image
      run: |
        docker build -t your-repo/credit-scoring-api:latest -f deployment/docker/Dockerfile .
    
    - name: Push Docker image
      run: |
        docker push your-repo/credit-scoring-api:latest

deploy-to-kubernetes:
    runs-on: ubuntu-latest
    needs: build-and-push-docker
    if: github.ref == 'refs/heads/main'
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Deploy to Kubernetes
      uses: kelseyhightower/awesome-kubernetes-actions@v1
      with:
        kubeconfig: ${{ secrets.KUBECONFIG }}
        command: kubectl apply -f deployment/kubernetes/
    - name: Wait for deployment to complete
      run: |
    kubectl rollout status deployment/credit-scoring-api