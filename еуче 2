 –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
–≠—Ç–∞–ø 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã
bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/CrimsonFox-hub/Main_prog_ci_cd_ml
cd Main_prog_ci_cd_ml

# 2. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv

# Windows:
venv\Scripts\activate
# Linux/MacOS:
source venv/bin/activate

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
pip install -r requirements-dev.txt
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
pip install onnx onnxruntime onnxscript

# 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å DVC
dvc init
dvc remote add -d yc s3://mlops-dvc-bucket
dvc remote modify yc endpointurl https://storage.yandexcloud.net
–≠—Ç–∞–ø 1: –û–±—É—á–µ–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
make data-download
make data-process

# 2. –û–±—É—á–∏—Ç—å –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–µ—Ç—å —Å ONNX —ç–∫—Å–ø–æ—Ä—Ç–æ–º
python src/ml_pipeline/training/train_model.py --config configs/training_config.yaml

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
ls -la models/trained/
ls -la reports/

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥
python src/ml_pipeline/optimization/model_optimizer.py
–≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Yandex Cloud)
bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å YC CLI
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
yc init

# 2. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è Terraform
yc iam service-account create --name terraform-sa
yc resource-manager folder add-access-binding <folder-id> \
  --role editor \
  --subject serviceAccount:<service-account-id>

# 3. –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª—é—á
yc iam key create --service-account-id <service-account-id> --output key.json

# 4. –°–æ–∑–¥–∞—Ç—å Container Registry
yc container registry create --name mlops-registry

# 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Terraform
cd infrastructure/environments/staging
terraform init

# 6. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞–Ω
terraform plan -var="yc_token=$(yc iam create-token)" \
  -var="yc_cloud_id=$(yc config get cloud-id)" \
  -var="yc_folder_id=$(yc config get folder-id)"

# 7. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
terraform apply -auto-approve \
  -var="yc_token=$(yc iam create-token)" \
  -var="yc_cloud_id=$(yc config get cloud-id)" \
  -var="yc_folder_id=$(yc config get folder-id)"
–≠—Ç–∞–ø 3: –°–±–æ—Ä–∫–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
bash
# 1. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ Container Registry
yc container registry configure-docker

# 2. –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
docker build -t cr.yandexcloud.net/<registry-id>/credit-scoring-api:latest -f docker/api/Dockerfile .
docker build -t cr.yandexcloud.net/<registry-id>/credit-scoring-training:latest -f docker/training/Dockerfile .

# 3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑—ã
docker push cr.yandexcloud.net/<registry-id>/credit-scoring-api:latest
docker push cr.yandexcloud.net/<registry-id>/credit-scoring-training:latest
–≠—Ç–∞–ø 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞
bash
# 1. –ü–æ–ª—É—á–∏—Ç—å kubeconfig
yc managed-kubernetes cluster get-credentials <cluster-id> --external

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ingress-nginx
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.1/deploy/static/provider/cloud/deploy.yaml

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cert-manager (–¥–ª—è SSL)
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.12.0/cert-manager.yaml

# 4. –°–æ–∑–¥–∞—Ç—å namespace
kubectl create namespace ml-production
kubectl create namespace monitoring
kubectl create namespace logging
–≠—Ç–∞–ø 5: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Kubernetes
bash
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
kubectl apply -f kubernetes/base/ -n ml-production

# 2. –°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã
kubectl create secret generic db-credentials \
  --from-literal=url=postgresql://user:pass@postgres:5432/credit_scoring \
  -n ml-production --dry-run=client -o yaml | kubectl apply -f -

# 3. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
kubectl apply -f kubernetes/credit-scoring-api/ -n ml-production

# 4. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
kubectl apply -f kubernetes/monitoring-stack/ -n monitoring

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
kubectl get all -n ml-production
kubectl get ingress -n ml-production
–≠—Ç–∞–ø 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ GitHub
bash
# –í GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Settings ‚Üí Secrets and variables ‚Üí Actions
# –î–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

# Yandex Cloud
YC_TOKEN: $(yc iam create-token)
YC_CLOUD_ID: $(yc config get cloud-id)
YC_FOLDER_ID: $(yc config get folder-id)
YC_SA_KEY: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ key.json
YC_REGISTRY_ID: <registry-id>
YC_ACCESS_KEY: $(yc iam access-key create --service-account-id <sa-id> --format json | jq -r .access_key.key_id)
YC_SECRET_KEY: $(yc iam access-key create --service-account-id <sa-id> --format json | jq -r .secret)

# Kubernetes
KUBECONFIG_STAGING: $(cat ~/.kube/config | base64)
KUBECONFIG_PRODUCTION: $(cat ~/.kube/config-prod | base64)

# –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL: postgresql://user:pass@postgres:5432/credit_scoring
REDIS_URL: redis://:password@redis:6379/0

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
SLACK_WEBHOOK_URL: https://hooks.slack.com/services/...
–≠—Ç–∞–ø 7: –ó–∞–ø—É—Å–∫ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞
bash
# 1. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "Initial MLOps setup"
git push origin main

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ GitHub Actions
# –û—Ç–∫—Ä—ã—Ç—å https://github.com/CrimsonFox-hub/Main_prog_ci_cd_ml/actions
–≠—Ç–∞–ø 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
bash
# 1. –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ Grafana
kubectl port-forward svc/grafana -n monitoring 3000:3000
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000 (admin/admin)

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã
# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ monitoring/dashboards/

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã
kubectl apply -f kubernetes/monitoring-stack/alerts/ -n monitoring
–≠—Ç–∞–ø 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Airflow –¥–ª—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Airflow –≤ –∫–ª–∞—Å—Ç–µ—Ä
helm repo add apache-airflow https://airflow.apache.org
helm install airflow apache-airflow/airflow \
  --namespace airflow \
  --create-namespace \
  --values kubernetes/airflow/values.yaml

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å DAG
kubectl cp dags/model_retraining_dag.py airflow/airflow-webserver-0:/opt/airflow/dags/

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å DAG
kubectl exec -n airflow airflow-webserver-0 -- airflow dags trigger credit_scoring_retraining
üö® 8. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—ã –≤ –æ–±–ª–∞–∫–µ:

bash
yc compute cloud get-quotas
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å:

bash
yc billing account list
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤:

bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
make up
curl http://localhost:8000/health
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:

bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –ª–æ–∫–∞–ª—å–Ω–æ
./scripts/test_full_pipeline.sh
üìä 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

bash
kubectl logs -l app=credit-scoring-api -n ml-production --tail=50
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏:

bash
kubectl port-forward svc/prometheus-k8s -n monitoring 9090:9090
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:9090
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—Ä–∏—Ñ—Ç:

bash
python src/ml_pipeline/monitoring/drift_detection.py \
  --config configs/monitoring_config.yaml \
  --hours 24